name: SPECTER VPN → Яндекс Cloud (TEST 5 мин)
concurrency:
  group: vpn-cloud-test
  cancel-in-progress: true
on:
  schedule:
    - cron: '0 */11 * * *'  # ← КАЖДЫЕ 5 МИНУТ!
  workflow_dispatch:     # ← Ручной запуск тоже работает

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
    
    - name: Install dependencies
      run: pip install boto3 requests
    
    - name: Update VPN keys
      env:
        YANDEX_ACCESS_KEY: ${{ secrets.YANDEX_ACCESS_KEY }}
        YANDEX_SECRET_KEY: ${{ secrets.YANDEX_SECRET_KEY }}
      run: python update_tariff15_cloud.py
    
    - name: Commit local backup (опционально)
      run: |
        git config user.name "vpn-bot"
        git config user.email "bot@vpn.com"
        git add tariff15.txt || true
        git commit -m "♻️ TEST Update every 5 min" || echo "No changes"
        git push || echo "No push needed"
